"use strict";var t=require("vue");exports.activePinia=void 0;const e=t=>exports.activePinia=t,s=Symbol();class n{constructor(){this.events={}}add(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)}trigger(t,...e){this.events[t]&&this.events[t].forEach((t=>t(...e)))}}function r(t){return"object"==typeof t&&null!==t}function i(e,s,n){const{state:r,getters:i,actions:a}=s;return o(e,(function(){n.state.value[e]=r?r():{};const s=t.toRefs(n.state.value[e]);return Object.assign(s,a,Object.keys(i||{}).reduce(((s,r)=>(s[r]=t.computed((()=>{const t=n._s.get(e);return i[r].call(t,t)})),s)),{}))}),s,n,!0)}function o(e,s,i,o,a){const c=new n,{state:u}=i,p={$id:e,$patch:function(t){"function"==typeof t?t(o.state.value[e]):v(o.state.value[e],t)},$subscribe(s,n={}){t.watch(o.state.value[e],(t=>{s({storeId:e},t)}),n)},$onAction:c.add.bind(c,"onAction"),$dispose:()=>{},$reset(){if(!a)throw new Error("🍎不能在setupStore中使用$reset!");const t=u?u():{};f.$patch((e=>{Object.assign(e,t)}))}},f=t.reactive(p),l=s();o.state.value[e]||a||(o.state.value[e]={});for(let s in l){const n=l[s];"function"==typeof n&&(l[s]=d(n)),a||(t.isRef(n)&&(g=n,!t.isRef(g)||!g.effect)||t.isReactive(n))&&(o.state.value[e][s]=n)}var g;function d(t){return function(){let e;c.trigger("onAction",{after:c.add.bind(c,"after"),onError:c.add.bind(c,"onError")});try{e=t.apply(f,Array.from(arguments)),c.trigger("after",e)}catch(t){c.trigger("onError",t)}return e}}function v(t,e){for(let s in e){let n=t[s],i=e[s];r(n)&&r(i)?t[s]=v(n,i):t[s]=i}}return o._s.set(e,f),Object.assign(f,l),Object.defineProperty(f,"$state",{get:()=>o.state.value[e],set(t){f.$patch((e=>Object.assign(e,t)))}}),o._p.forEach((t=>{Object.assign(f,t({pinia:o,store:f}))})),f}exports.EventEmitter=n,exports.addSubscription=function(t,e){return t.push(e),()=>{const s=t.indexOf(e);s>-1&&t.splice(s,1)}},exports.createOptionsStore=i,exports.createPinia=function(){let e={_s:new Map,_p:[],state:t.ref({}),install(t){t.provide(s,e),console.log("mPinia🍎installed",e)},use(t){return this._p.push(t),this}};return e},exports.createSetupStore=o,exports.crossPagePlugin=function({pinia:t,store:e}){const s=new BroadcastChannel("pinia-zlj");e.$subscribe((({storeId:t},n)=>{s.postMessage(JSON.stringify(e.$state))})),s.onmessage=t=>{e.$state=JSON.parse(t.data)}},exports.defineStore=function(n,r){let a,c;return"string"==typeof n?(a=n,c=r):(a=n.id,c=n),function(){const n=t.getCurrentInstance();let u;if(exports.activePinia)u=exports.activePinia;else{if(null===n)throw new Error("🍎未在组件中使用并且没有设置activePinia");u=n&&t.inject(s)}return e(u),u._s.has(a)||("function"==typeof r?o(a,r,c,u,!1):i(a,c,u)),u._s.get(a)}},exports.persistentPlugin=function({pinia:t,store:e}){let s=localStorage.getItem(`PINIA_ZLJ_${e.$id}`);s&&(e.$state=JSON.parse(s)),e.$subscribe((({storeId:t},e)=>{localStorage.setItem(`PINIA_ZLJ_${t}`,JSON.stringify(e))}))},exports.piniaSymbol=s,exports.setActivePinia=e,exports.triggerSubscriptions=function(t,...e){t.slice().forEach((t=>t(...e)))};
