import{ref as t,watch as e,reactive as n,isRef as s,isReactive as r,getCurrentInstance as o,inject as i,toRefs as a,computed as c}from"vue";let u;const f=t=>u=t,l=Symbol();function p(){let e={_s:new Map,_p:[],state:t({}),install(t){t.provide(l,e),console.log("mPinia🍎installed",e)},use(t){return this._p.push(t),this}};return e}function g(t,e){t.push(e);return()=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)}}function d(t,...e){t.slice().forEach((t=>t(...e)))}class h{constructor(){this.events={}}add(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)}trigger(t,...e){this.events[t]&&this.events[t].forEach((t=>t(...e)))}}function v(t){return"object"==typeof t&&null!==t}function b(t,e,n){const{state:s,getters:r,actions:o}=e;return $(t,(function(){n.state.value[t]=s?s():{};const e=a(n.state.value[t]);return Object.assign(e,o,Object.keys(r||{}).reduce(((e,s)=>(e[s]=c((()=>{const e=n._s.get(t);return r[s].call(e,e)})),e)),{}))}),e,n,!0)}function $(t,o,i,a,c){const u=new h,{state:f}=i,l={$id:t,$patch:function(e){"function"==typeof e?e(a.state.value[t]):$(a.state.value[t],e)},$subscribe(n,s={}){e(a.state.value[t],(e=>{n({storeId:t},e)}),s)},$onAction:u.add.bind(u,"onAction"),$dispose:()=>{},$reset(){if(!c)throw new Error("🍎不能在setupStore中使用$reset!");const t=f?f():{};p.$patch((e=>{Object.assign(e,t)}))}},p=n(l),g=o();a.state.value[t]||c||(a.state.value[t]={});for(let e in g){const n=g[e];"function"==typeof n&&(g[e]=b(n)),c||(s(n)&&(!s(d=n)||!d.effect)||r(n))&&(a.state.value[t][e]=n)}var d;function b(t){return function(){let e;u.trigger("onAction",{after:u.add.bind(u,"after"),onError:u.add.bind(u,"onError")});try{e=t.apply(p,Array.from(arguments)),u.trigger("after",e)}catch(t){u.trigger("onError",t)}return e}}function $(t,e){for(let n in e){let s=t[n],r=e[n];v(s)&&v(r)?t[n]=$(s,r):t[n]=r}}return a._s.set(t,p),Object.assign(p,g),Object.defineProperty(p,"$state",{get:()=>a.state.value[t],set(t){p.$patch((e=>Object.assign(e,t)))}}),a._p.forEach((t=>{Object.assign(p,t({pinia:a,store:p}))})),p}function y(t,e){let n,s;return"string"==typeof t?(n=t,s=e):(n=t.id,s=t),function(){const t=o();let r;if(u)r=u;else{if(null===t)throw new Error("🍎未在组件中使用并且没有设置activePinia");r=t&&i(l)}return f(r),r._s.has(n)||("function"==typeof e?$(n,e,s,r,!1):b(n,s,r)),r._s.get(n)}}function O({pinia:t,store:e}){let n=localStorage.getItem(`PINIA_ZLJ_${e.$id}`);n&&(e.$state=JSON.parse(n)),e.$subscribe((({storeId:t},e)=>{localStorage.setItem(`PINIA_ZLJ_${t}`,JSON.stringify(e))}))}function _({pinia:t,store:e}){const n=new BroadcastChannel("pinia-zlj");e.$subscribe((({storeId:t},s)=>{n.postMessage(JSON.stringify(e.$state))})),n.onmessage=t=>{e.$state=JSON.parse(t.data)}}export{h as EventEmitter,u as activePinia,g as addSubscription,b as createOptionsStore,p as createPinia,$ as createSetupStore,_ as crossPagePlugin,y as defineStore,O as persistentPlugin,l as piniaSymbol,f as setActivePinia,d as triggerSubscriptions};
