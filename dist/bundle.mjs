import{ref as t,watch as e,reactive as n,isRef as s,isReactive as r,getCurrentInstance as o,inject as i,toRefs as c,computed as a}from"vue";let u;const f=t=>u=t,l=Symbol();function p(){let e={_s:new Map,_p:[],state:t({}),install(t){t.provide(l,e),console.log("mPinia🍎installed",e)},use(t){return this._p.push(t),this}};return e}function h(t,e){t.push(e);return()=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)}}function d(t,...e){t.slice().forEach((t=>t(...e)))}class g{constructor(){this.events={}}add(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)}trigger(t,...e){this.events[t]&&this.events[t].forEach((t=>t(...e)))}}function v(t){return"object"==typeof t&&null!==t}function b(t,e,n){const{state:s,getters:r,actions:o}=e;return y(t,(function(){n.state.value[t]=s?s():{};const e=c(n.state.value[t]);return Object.assign(e,o,Object.keys(r||{}).reduce(((e,s)=>(e[s]=a((()=>{const e=n._s.get(t);return r[s].call(e,e)})),e)),{}))}),e,n,!0)}function y(t,o,i,c,a){const u=new g,{state:f}=i,l={$id:t,$patch:function(e){"function"==typeof e?e(c.state.value[t]):y(c.state.value[t],e)},$subscribe(n,s={}){e(c.state.value[t],(e=>{n({storeId:t},e)}),s)},$onAction:u.add.bind(u,"onAction"),$dispose:()=>{},$reset(){if(!a)throw new Error("🍎不能在setupStore中使用$reset!");const t=f?f():{};p.$patch((e=>{Object.assign(e,t)}))}},p=n(l),h=o();c.state.value[t]||a||(c.state.value[t]={});for(let e in h){const n=h[e];"function"==typeof n&&(h[e]=b(n)),a||(s(n)&&(!s(d=n)||!d.effect)||r(n))&&(c.state.value[t][e]=n)}var d;function b(t){return function(){let e;u.trigger("onAction",{after:u.add.bind(u,"after"),onError:u.add.bind(u,"onError")});try{e=t.apply(p,Array.from(arguments)),u.trigger("after",e)}catch(t){u.trigger("onError",t)}return e}}function y(t,e){for(let n in e){let s=t[n],r=e[n];v(s)&&v(r)?t[n]=y(s,r):t[n]=r}}return c._s.set(t,p),Object.assign(p,h),Object.defineProperty(p,"$state",{get:()=>c.state.value[t],set(t){p.$patch((e=>Object.assign(e,t)))}}),c._p.forEach((t=>{Object.assign(p,t({pinia:c,store:p}))})),p}function $(t,e){let n,s;return"string"==typeof t?(n=t,s=e):(n=t.id,s=t),function(){const t=o();let r;if(u)r=u;else{if(null===t)throw new Error("🍎未在组件中使用并且没有设置activePinia");r=t&&i(l)}return f(r),r._s.has(n)||("function"==typeof e?y(n,e,s,r,!1):b(n,s,r)),r._s.get(n)}}export{g as EventEmitter,u as activePinia,h as addSubscription,b as createOptionsStore,p as createPinia,y as createSetupStore,$ as defineStore,l as piniaSymbol,f as setActivePinia,d as triggerSubscriptions};
